<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Round 4: JavaScript and Ajax</title>
  <link rel="stylesheet" type="text/css" href="../lib/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../lib/exercises.css" />
</head>
<body>

<div id="exercises">
<h1>Round 4: JavaScript and Ajax</h1>
<ol>
	<li><a href="#questionnaire">JavaScript and Ajax Questionnaire</a></li>
	<li><a href="#postmessage">JavaScript PostMessage</a></li>
	<li><a href="#ajax"></a>Using jQuery AJAX when consuming an API</li>
</ol>
</div>

<div class="content" id="questionnaire">
	<h1>1. JavaScript and Ajax Questionnaire</h1>
	<p>Enter correct answers in the form at Plussa.</p>
</div>

<div class="content" id="postmessage">
	<h1>2. Javascript PostMessage</h1>
	<p>This exercises involves using <code>.postMessage()</code> to send messages from an iframe to the parent document. You are to write a simple 'service' in <code>reverser_service.html</code> that takes a string, reverses it and sends it as a message to the document that contains reverser_service.html as an iframe.</p>
	<p><img src="img/reverser_service.png" alt="Example of reverser_service.html"></p>

	<p><code>user_actions.html</code> is given to you so you can test your solution with that. Note that you should not rely on any modifications on user_actions.html, the grading will be done using the given file. The messages should have a payload attribute that contains:</p>
	<ol>
		<li>... either the string that was typed into <code>#toBeReversed</code> reversed if the <code>#reverser</code> form was submitted.</li>
		<li>... or 'INPUT CLEARED' if the <code>#clearInput</code> was clicked.</li>
	</ol>

	<pre>
	//Example message
	msg = {};
	msg.payload = 'elloH'; // (1) #toBeReversed contained 'Hello' and user submitted #reverser
	msg.payload = 'INPUT CLEARED' // (2) User clicked #clearInput</pre>

	<p class="warning">Note that you can assume that the grader will also have 'lib/jquery-3.2.1.min.js'.</p>
	<h3>Where to Start</h3>
	<ul>
		<li>Read about postMessage from <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage">MDN</a>.</li>
		<li>Create <code>reverser_service.html</code> and create the necessary elements.</li>
		<li>Write the JavaScript code that handles the user actions and sends messages to the <code>window.parent</code>.
			Write the code inside the HTML file.</li>
	</ul>

	<h3>Submitting Your Project to Plussa</h3>
	<p>Add, commit and push your new files and possible changes to the Git as in round 1.
	Finally, just copy and paste your GitLab project's URL to Plussa. The file we will check
	is <code>exercises/06_javascript_ajax/reverser_service.html</code>.</p>
</div>

<div class="content" id="ajax">
  <h1>3. Using jQuery AJAX when consuming an API</h1>
  <h3>API to be consumed</h3>
  <p>In this exercise you will be consuming the simplest possible RESTful API, which offers data about rented electric scooter trips. The documentation for the API can be found <a href="https://bwa-2019-2020.herokuapp.com/docs/">here (autogenerated by Swagger, by the way)</a>.</p>
  <p>From the documentation it can be seen that the base URL is <em>bwa-2019-2020.herokuapp.com/v1</em>. This is what URLs of all the request to this API have to start with.</p>
  <p>In this API, there is only one API endpoint: <em>/trips</em>, and we will use it. That endpoint is documented <a href="https://bwa-2019-2020.herokuapp.com/docs/#/trip/tripsGET">on the documentation page too</a>.</p>
  <p>The endpoint requires that we use an X-API-key header in our requests. The value used for the X-API-key in this exercise is <code>bwa_2019-2020</code>. In this exercise you also must also use both the startDate and endDate query parameters in your requests. So, an example of a valid request using <em>curl</em> would be:<br> <code>curl -X GET --header "X-API-Key: bwa_2019-2020" "https://bwa-2019-2020.herokuapp.com/v1/trips?startDate=2019-09-20&endDate=2019-09-21"</code>.</p>
  <p>There is trip data available from 2017-04-18 to 2019-09-21</p>
  <p>Dates have to be in the format YYYY-MM-DD, which is conviniently the format HTML form datepicker element gives them in.</p>
  <p>Maximum of 20 trips are returned in the response.</p>

  <h3>Static parts</h3>
  <p>Start by creating new <code>trips.html</code> and <code>trips.js</code>
    files. Create an empty HTML5 page and include the jQuery library and your own
    JavaScript file after it. For grading you must include the jQuery like this:
  </p>
  <pre>&lt;script src="lib/jquery-3.2.1.min.js"&gt;&lt;/script&gt;</pre>
  <p> Next, add a form element which contains two date input elements (<code>input type=date</code>):
    one with <code>id=startDate</code>, another with <code>id=endDate</code>. For submitting the form add a <code>input type=submit</code> element
    with <code>id=search</code>. This form is used to query the API with the
    entered dates. The form can look for example like in the image below.
    Furthermore, after the form add an empty table element with <code>id=trips</code> to the page. It is used for
    adding the trips later on. Example of what the form page would intially look like is shown below.
    <img alt="Example query form" style="width:100%;" src="img/form_page_initial.png"/>

  <h3>Use $.support.cors = true with $.ajax in this exercise</h3>
  <p>The grading system uses a headless browser, and its limited abilities require that <em>$.support.cors;</em> is enabled in <em>trips.js</em> when using $.ajax and other AJAX methods. You can do this by adding <em>$.support.cors = true;</em> line in your code before you make any jQuery AJAX calls.</p>

  <p>For local testing using <em>$.support.cors</em> isn't necassary. It is in fact discouraged, as the whole $.support has been depracated since jQuery 1.9 (for more information read: <a href="https://api.jquery.com/jQuery.support/">jQuery.support</a>). But for this exercise it must be used.</p>

  <h3>Using jQuery AJAX methods</h3>
  <p>
    First you need wait for the HTML DOM to be completely loaded and prepared before looking for any DOM elements.
    <a href="http://api.jquery.com/ready/">Check jQuery examples for document ready.</a>
  </p>
  <p>
    Now using jQuery, select the form and attach an event listener to <code>submit</code> event. In the handler function remember to prevent the default action so that the page is not reloaded when the form is submitted.
    You can use <code>console.log("remarks", somedata);</code> to debug how your code works.
  </p>
  <p>
    Some useful jQuery functions:</br>
    <a href="http://api.jquery.com/on/">on</a>,</br>
    <a href="http://api.jquery.com/event.preventDefault">event.preventDefault</a>,</br>
    <a href="http://api.jquery.com/val/">val</a>,</br>
    <a href="http://api.jquery.com/jquery.ajax/">jQuery.ajax</a>.
  </p>

  <h3>Dynamicly adding and removing DOM elements</h3>
  <p>
    Use jQuery AJAX to request resources from the API. After the jQuery AJAX request has been resolved to a response, that response should include a data object which holds the data received from the API. To see this data, you can for example use Developer Tools in your browser after you console.log the received data in your code. Let's say that the received object is in variable <code>data</code>. The trips, if any were found, are in <code>data</code> as an array that you should loop through to handle each trip.
  </p>
  <p>
    Next, you will populate the <code>table#trips</code> so that each row of the table holds the required information about one trip. Each line must have two cells, where the first one is the <em>scooterId</em> of the trip, while the second holds the <em>average speed</em> of the trip. An example of the page listing results from a response is shown below. <img alt="Form page with trips queried" style="width:100%;" src="img/form_page_after_response.png"/
  </p>
  <p>
    You do not have to handle errors in the API requests. However, you should always empty the old table before querying for new data. No data from earlier requests can be present in the table.
  </p>

  <!--
  <h3>Styling your application (bonus exercise, not graded)</h3>
  <p>
    This would be a good chance to try some CSS styles. It would be hard to automatically
    judge your styling choices so no points are awarded. You can for example create a
    framed picture wall by adjusting image flow, spacing, borders and background.
  </p>
  -->

  <h3>Submitting Your Project to Plussa</h3>
  <p>
    <strong>Please make sure that you have used the required id:s (<code>startDate</code>, <code>endDate</code>,
    <code>search</code>, <code>trips</code>) in correct elements.</strong>
  </p>
  <p>
    Add, commit and push your new files and possible changes to the Git as in round 1.
    Finally, just copy and paste your GitLab project's URL to Plussa. The files we will check
    are <code>exercises/06_javascript_ajax/trips.html</code> and
    <code>exercises/06_javascript_ajax/trips.js</code>.
  </p>
</div>

</body>
</html>
